import { deepCopy, deepCopyWithValidation } from '../types/json.js';
/**
 * Agent state provides key-value storage outside conversation context.
 * State is not passed to the model during inference but is accessible
 * by tools (via ToolContext) and application logic.
 *
 * All values are deep copied on get/set operations to prevent reference mutations.
 * Values must be JSON serializable.
 *
 * @example
 * ```typescript
 * const state = new AgentState({ userId: 'user-123' })
 * state.set('sessionId', 'session-456')
 * const userId = state.get('userId') // 'user-123'
 * ```
 */
export class AgentState {
    _state;
    /**
     * Creates a new AgentState instance.
     *
     * @param initialState - Optional initial state values
     * @throws Error if initialState is not JSON serializable
     */
    constructor(initialState) {
        if (initialState !== undefined) {
            this._state = deepCopyWithValidation(initialState, 'initialState');
        }
        else {
            this._state = {};
        }
    }
    get(key) {
        if (key == null) {
            throw new Error('key is required');
        }
        const value = this._state[key];
        if (value === undefined) {
            return undefined;
        }
        // Return deep copy to prevent mutations
        return deepCopy(value);
    }
    set(key, value) {
        this._state[key] = deepCopyWithValidation(value, `value for key "${key}"`);
    }
    delete(key) {
        delete this._state[key];
    }
    /**
     * Clear all state values.
     */
    clear() {
        this._state = {};
    }
    /**
     * Get a copy of all state as an object.
     *
     * @returns Deep copy of all state
     */
    getAll() {
        return deepCopy(this._state);
    }
    /**
     * Get all state keys.
     *
     * @returns Array of state keys
     */
    keys() {
        return Object.keys(this._state);
    }
}
//# sourceMappingURL=state.js.map